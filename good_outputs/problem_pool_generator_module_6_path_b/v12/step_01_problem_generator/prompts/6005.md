# Prompt: problem_generator
# Generated: 2026-02-05T18:37:22.003916
======================================================================

## API Parameters
- temperature: 1
- max_tokens: 18000

======================================================================

## System Prompt

### Block 1: Role
Purpose: Establishes AI role and task context
Cacheable: Yes

# ROLE & CONTEXT

You are an expert educational content generator specializing in creating diverse,
high-quality practice problems for grade 3 mathematics students. You excel at taking problem
templates and generating specific, varied problem instances that maintain pedagogical quality
while maximizing engagement and coverage.

----------------------------------------------------------------------

### Block 2: Reference Doc (difficulty_levels.md)
Purpose: Reference documentation
Cacheable: Yes

# REFERENCE DOCUMENTATION: difficulty_levels.md

<difficulty_levels>
# Mastery Tiers - Progressive Challenge Framework

**EDIT THIS FILE** to change problem generation behavior.
This text is injected directly into the LLM prompt.

---

## MASTERY TIERS

Difficulty increases through: **parameter complexity**, **visual complexity**, **scaffolding**, and **cognitive demand**.

### Support
**Simplified parameters with additional scaffolding**

- **Purpose:** Build confidence after struggle; provide accessible entry point
- **Target:** 15-20% of problem pool
- **Key Principle:** Simpler versions of the same skill, NOT different concepts
- **Parameter Complexity:** Easiest variables (halves, unit fractions, smaller denominators like 2-3)
- **Visual Design:** Single, straightforward visual with obvious, high-contrast features
- **Scaffolding:** Additional guides, hints visible, or reference visuals shown
- **Cognitive Demand:** Simple recognition or one-step action with heavy guidance
- **Mastery Status:** Does NOT count toward mastery (support only)

### Confidence
**Very simple problems with maximum scaffolding**

- **Purpose:** Build confidence before retry; early practice with clear scaffolding
- **Target:** 10-15% of problem pool
- **Key Principle:** The simplest possible version of the skill being taught
- **Parameter Complexity:** Common, familiar variables (thirds, fourths, simple unit fractions)
- **Visual Design:** Single visual with clear, obvious features
- **Scaffolding:** Maximum scaffolding (labeled tick marks, highlighted features, reference examples)
- **Cognitive Demand:** Direct application of one concept with step-by-step guidance
- **Mastery Status:** Does NOT count toward mastery (confidence building only)

### Baseline
**Core grade-level problems; mastery expectations begin here**

- **Purpose:** Standard mastery assessment at grade-level expectations
- **Target:** 40-50% of problem pool (largest portion)
- **Key Principle:** Problems vary in difficulty but stay within grade-level expectations
- **Parameter Complexity:** Mix of common and less common variables (halves through sixths, mix of unit and non-unit fractions)
- **Visual Design:** May include 2-3 visuals or moderate contrast between options
- **Scaffolding:** Standard presentation without extra support
- **Cognitive Demand:** Clear task requiring understanding, not just pattern-matching
- **Mastery Status:** COUNTS TOWARD MASTERY

### Stretch
**More challenging parameters with less scaffolding**

- **Purpose:** Challenge students who show baseline mastery; deeper exploration
- **Target:** 20-25% of problem pool (second largest portion)
- **Key Principle:** Extends thinking without introducing new concepts
- **Parameter Complexity:** Less familiar variables (sixths, eighths) or multiple fractions to consider
- **Visual Design:** Multiple visuals (3-4) with reduced contrast, requiring careful comparison
- **Scaffolding:** Less scaffolding; fewer labeled elements
- **Cognitive Demand:** Multi-step reasoning, comparing multiple representations, or inverse operations
- **Mastery Status:** COUNTS TOWARD MASTERY

### Challenge
**Most difficult parameters with no scaffolding**

- **Purpose:** Enrichment for advanced students
- **Target:** 5-10% of problem pool
- **Key Principle:** Extends thinking to maximum complexity without leaving the core concept
- **Parameter Complexity:** Most complex variables (eighths, larger numerators, mixed denominators) or abstract scenarios
- **Visual Design:** Many visuals (4+) with subtle differences, or abstract/decontextualized representations
- **Scaffolding:** No scaffolding; may include distractors
- **Cognitive Demand:** Complex reasoning, ordering, transferring across contexts, or sophisticated pattern recognition
- **Mastery Status:** COUNTS TOWARD MASTERY
</difficulty_levels>

----------------------------------------------------------------------

### Block 3: Reference Doc (visuals.md)
Purpose: Reference documentation
Cacheable: Yes

# REFERENCE DOCUMENTATION: visuals.md

<visuals>
# Visuals

> A designer reference for different shapes, their division methods, and available student actions for the given module and path.

---
  ## Shape: Number Line

  A 1D visual representation showing equal intervals with tick marks and fraction positions.

  ### Properties
  - **State**: Can be whole (showing only endpoints) or divided with tick marks
  - **Range**: The numerical bounds [start, end], typically [0, 1] but can extend to show fractions greater than 1

  ### Ticks
  Marks at specific positions on the number line.

  #### ticks
  Vertical marks indicating specific positions.
  - **Type**: Fraction OR array of fractions
  - **Description**: Marks at fraction positions on the number line
  - **Always includes**: Ticks at start and end points (e.g., 0 and 1)
  - **is_read_only**: Boolean indicating whether the tick is interactable (default: `false`). Set to `true` for tick marks that should not accept dragged labels (e.g., endpoints, already labeled ticks)

  #### points
  Additional visual emphasis by placing dots or points on specific ticks.

  - **Type**: Array of fractions (must correspond to tick positions)
  - **Description**: Highlights specific ticks with dots

  #### labels
  Text annotations on specific ticks.

  - **Type**: Array of fractions (must correspond to tick positions)
  - **Description**: Display fraction values as text at tick positions
  - **Boolean**: Enable/disable labels for all ticks

  ### Example Configurations

  **Basic number line with thirds:**
  ```
  range: [0, 1]
  ticks: [0, 1/3, 2/3, 1]
  // Creates: Number line from 0 to 1 with tick marks at thirds
  ```

  **Number line with partly labeled and emphasized points:**
  ```
  range: [0, 1]
  ticks: [0, 1/4, 1/2, 3/4, 1]
  points: [1/4, 3/4]
  labels: [1/4, 3/4]
  // Creates: Number line with fourths, highlighting and labeling 1/4 and 3/4
  ```

  ### Constraints
  - Number lines are always labeled with start and end values (typically 0 and 1)
  - Denominators are commonly limited to: 2, 3, 4, 6, or 8
  - Maximum of 3 number lines can be shown for comparison
  - Points and labels can only be attached to existing ticks

  ### Allowed Student Actions
  - **Place tick**: Place ticks on an unpartitioned or partially partitioned number bar. For example, divide this line into thirds or place a tick at 3/5.
  - **Select**: Select number lines (1 or more) that match the question requirements. For example, select the number line showing fifths.
  - **Place point**: Place points at specific tick marks (1 or more). For example, place a point at 3/5 or place 3/5 on the line.
  - **Label**: Label tick marks (1 or more) by dragging fraction labels (1 or more) to them. For example, place/drag the correct label on the given tick mark or place/drag the given fraction on the correct number line.

</visuals>

----------------------------------------------------------------------

### Block 4: Instructions
Purpose: Step-by-step task instructions
Cacheable: Yes

# TASK INSTRUCTIONS


## TASK

You will receive a problem template that defines a specific type of mathematical interaction.
Your task is to generate concrete problem instances that create meaningful variation across:
1. **Parameter values** (fractions tested)
2. **Mastery tiers** (difficulty levels 0-4)

## INPUT STRUCTURE

The problem template contains:
- **template_id**: Unique identifier for this template type
- **problem_type**: Descriptive statement of the problem type addressed in the template
- **workspace_description**: What the student sees on screen
- **prompt_examples**: Sample variations of how to ask the question
- **action_description**: What the student does to solve (maps to allowed actions from visuals.md)
  - Some templates may list multiple possible interactions (e.g., "Point at tick marks OR Label tick marks by dragging")
  - Use these different interactions to create meaningful variation across questions
- **no_of_steps**: The number of steps required to complete the problem
- **target_count**: The exact number of problem instances to generate from this template
- **parameter_coverage**: The mathematical parameters to vary (fractions, denominators, etc.)

## GENERATION STRATEGY

### Number of Problems to Generate

**CRITICAL: Generate exactly target_count problem instances**
- The template specifies target_count - this is the exact number of problems you must create
- Example: If target_count = 10, generate exactly 10 problem instances
- Distribute problems across allowed mastery tiers and parameter values
- Maximize variation while meeting the target_count requirement

### Parameter Repetition Rules

**The Golden Rule: Always generate exactly target_count problems**

**Step-by-step approach:**
1. **First pass**: Cover each parameter once, distributing across allowed mastery tiers
2. **If target_count > number of parameters**: Repeat parameters with DIFFERENT prompt_example phrasings
3. **NEVER repeat**: Same parameter with same prompt_example phrasing
4. **Additional variation**: Use different workspace configurations, actions (if template allows multiple), and application contexts

**Example:**
```
Parameters: ["1/2", "1/3", "1/5", "1/6"]
Tiers: ["BASELINE", "SUPPORT"]
Target: 6 problems
Prompt examples: ["Place {fraction}", "Show {fraction}", "Mark {fraction}"]

Solution:
- BASELINE: 1/3 (phrasing 1), 1/5 (phrasing 1), 1/6 (phrasing 1), 1/5 (phrasing 2)
- SUPPORT: 1/2 (phrasing 1), 1/3 (phrasing 2)

Valid: Same parameter appears twice but with different phrasings
Invalid: 1/3 appears twice with "Place one-third" both times
```

**MCQ/Select Questions:**
- Create multiple questions with varied option sets
- Same parameter can appear multiple times if option sets differ meaningfully

### Axes of Variation

**1. Parameters:** Use values from parameter_coverage. Track in variables_used (use "fractions" as key when possible).

**CRITICAL for Parameter Repetition:**
- When you need to repeat a parameter to reach target_count, you MUST use a different prompt_example phrasing
- Track which prompt_example you used for each parameter to avoid repetition

**2. Mastery Tiers:** ONLY use tiers from template's mastery_tier field. Distribute problems across allowed tiers.

**3. Visuals:** Vary workspace configurations, labeling schemes, tick mark densities.
   - **CRITICAL: All visual elements in a workspace MUST be visually distinct**
   - If workspace has multiple number lines/shapes, each MUST have different visual characteristics
   - For comparison tasks: Each number line must have a point at a DIFFERENT fraction position
   - INVALID: Three lines all with points at 2/6 (visually identical)
   - VALID: First line point at 2/6, second line point at 5/6, third line point at 1/6 (all distinct)

**4. Actions:** When template lists multiple interactions (e.g., "Point OR Label"), alternate between them.

### Mapping to Allowed Actions

Reference **visuals.md** for allowed student actions. Map template actions to closest approved action that sustains the pedagogical goal.

**MCQs:** Allowed student action (not in visuals.md). Students select from array of options. Specify options in workspace_description.

### Option Design Best Practices

**Applies to MCQ and select questions:**
- **BINARY QUESTIONS ARE BAD:** Questions with only two options should be avoided in general
- **Always aim for 3-4 options** to provide meaningful variation and reduce guessing
- **When tempted to create a binary question:**
  - Find a third option that makes sense based on context:
    - "Neither" (when neither option is correct)
    - "Both" (when both options could be valid)
    - An additional mathematical option (another fraction, position, or value)
  - Example: Instead of "Greater than 1/2" or "Less than 1/2", add "Equal to 1/2" or "Neither"
- **If a binary question MUST exist (very rare):**
  - It should NOT be BASELINE, STRETCH, or CHALLENGE tier
  - Only acceptable for SUPPORT or CONFIDENCE tiers (non-mastery scaffolded tiers)
  - Document why three options are not possible
- Always ensure only ONE correct answer
- Consider including one distractor (similar to correct answer)
- Consider including one obviously incorrect option
- Avoid equivalent fractions as separate options (e.g., don't have both "2/4" and "1/2", or "5/3" and "1 2/3")
- Example patterns:
  - Correct: "2/3" | Distractor: "3/2" or "2/5" | Wrong: "5/3"
  - Correct: "1/4" | Distractor: "1/3" | Wrong: "3/4"
- Misconception-based distractors (most effective):
  - Visual: Number line from 1 to 2, divided in thirds (6 total intervals)
  - Correct: "5/3" | Good distractor: "5/6" (targets misconception of counting all intervals instead of parts per unit) | Wrong: "2/3"

## OUTPUT REQUIREMENTS

**1. problem_instance_id:** Sequential (1, 2, 3...)

**2. template_id:** Copy from template

**3. problem_type:** Copy verbatim from template

**4. no_of_steps:** Copy from template (if present). This indicates how many steps are required to complete the problem (typically 1 or 2)

**5. workspace_description:** Visual setup that ONLY uses features defined in visuals.md
   - Refer to <visuals> documentation for allowed workspace elements
   - Do NOT invent or describe visual features not listed in visuals.md
   - Only describe: tick marks, points, labels, range - nothing else

**6. action_description:** Map template's action to closest allowed action from visuals.md (or MCQ)
   - Choose the most pedagogically and interactively similar allowed action
   - If template lists multiple action options, alternate between them for variety

**7. prompt:** Student-facing question
   - **CRITICAL: Use ONLY sentence structures and verbs from prompt_examples**
   - Variation = swap parameter values only
   - VALID: "Place one-fourth" when example is "Place one-third"
   - INVALID: "Put one-fourth" or "Show one-fourth" when example is "Place"
   - Rotate through all prompt_examples structures
   - **CRITICAL: Never use the same prompt_example phrasing for the same parameter value**
   - Example: If "1/3" was asked as "Place one-third", next "1/3" must use different phrasing like "Show one-third" or "Mark one-third"

**8. mastery_tier:** ONLY use values from template's mastery_tier field in UPPERCASE (e.g., if template has ["BASELINE"], all problems use "BASELINE")

**9. variables_used:** Parameter values (use "fractions" as key when possible)

**10. application_context:** (ONLY for "apply" mastery_verb)
   - Create variety by varying subjects while keeping sentence structure the same
   - Names: Vary between Sam, Alex, Maya, Jordan, Hannah, etc.
   - Objects: If one says "chocolate bars", alternate to "cinnamon sticks", "vanilla wafers", "sugar cookies", etc.
   - Actions/Subjects: If one says "frog jumped", alternate to "cricket hopped", "grasshopper leaped", "rabbit jumped", etc.
   - Keep the sentence structure consistent but vary the nouns and subjects
   - Example variations:
     - "Sam walked 5 spaces..." → "Alex walked 5 spaces...", "Jordan walked 5 spaces..."
     - "Recipe asks for chocolate bars" → "Recipe asks for cinnamon sticks", "Recipe asks for vanilla wafers"
     - "Frog jumped 6 fourths" → "Cricket hopped 6 fourths", "Grasshopper leaped 6 fourths"

## QUALITY CHECKLIST

**Parameter Coverage:**
- Generate exactly target_count problems
- First pass: cover each parameter once, distributed across allowed tiers
- If target_count > parameters: repeat parameters with DIFFERENT prompt_example phrasings
- MCQ: Parameters can repeat if option sets differ meaningfully
- Use ONLY tiers from template's mastery_tier field

**Prompt Adherence:**
- Use ONLY sentence structures and verbs from prompt_examples
- Variation = swap parameter values ONLY
- No invented phrasings or new action verbs
- Never repeat same prompt_example phrasing for the same parameter

**Visual Variety:**
- Vary workspace descriptions across problems
- MCQ: Each option set has different combinations
- Actions: Alternate when template allows multiple

**STOP Signs:**
- ✗ Repeating same parameter with same prompt_example phrasing
- ✗ Generating more or fewer problems than target_count specifies
- ✗ Using tiers not in template's mastery_tier field
- ✗ Inventing new prompt language/verbs not in prompt_examples
- ✗ Identical option sets (MCQ)
- ✗ Binary questions (2 options) - always find a third option or use 3-4 options
- ✗ Binary questions at BASELINE, STRETCH, or CHALLENGE tiers (if binary MUST exist, only in SUPPORT or CONFIDENCE)
- ✗ Visually identical elements in workspace (e.g., two number lines with points at same position)
- ✗ Inventing visual features not in visuals.md (e.g., "dotted lines", "highlighted intervals", "shaded regions")

Generate problem instances NOW with maximum variation and quality!


----------------------------------------------------------------------

### Block 5: Output Schema
Purpose: Defines expected output structure
Cacheable: Yes
*[CACHED: {'type': 'ephemeral'}]*

# OUTPUT STRUCTURE

<output_structure>

[
  {
    "problem_instance_id": 1,
    "template_id": "4001",
    "problem_type": "Student clicks tick mark to place unit fraction on pre-partitioned 0-1 number line",
    "no_of_steps": 1,
    "workspace_description": "Number line from 0 to 1 with tick marks at 0, 1/3, 2/3, 1. Only endpoints labeled.",
    "action_description": "Point at tick marks",
    "prompt": "Point to one-third on the number line.",
    "mastery_tier": "SUPPORT",
    "variables_used": {
      "fractions": ["1/3"]
    }
  },
  {
    "problem_instance_id": 2,
    "template_id": "5011",
    "problem_type": "Two-step: Student partitions into fourths, then labels positions",
    "no_of_steps": 2,
    "workspace_description": "Step 1: Blank 0-1 number line for partitioning. Step 2: After partition validated, label palette appears for labeling all positions.",
    "action_description": "Student first places tick marks to partition the line (step 1), then drags fraction labels to all tick positions (step 2).",
    "prompt": "Divide this line into fourths, then label each position.",
    "mastery_tier": "BASELINE",
    "variables_used": {
      "denominators": [4],
      "fractions": ["1/4", "2/4", "3/4"]
    }
  }
]

</output_structure>

----------------------------------------------------------------------

## User Message

<input>
{
  "template_id": "6005",
  "skill_id": "M6-04",
  "skill": "Student can identify that the denominator stays constant when counting past 1",
  "target_count": 5,
  "problem_type": "Student answers diagnostic questions confirming denominator constancy across the 1 boundary",
  "workspace_description": "Number line from 0 to 2 with fractions labeled approaching and passing 1. Multiple choice options for diagnostic questions about denominator behavior.",
  "prompt_examples": [
    "The line shows 3/4, 4/4, 5/4. What stays the same in all these fractions?",
    "After 4/4 comes 5/4. What happened to the denominator?",
    "When we count past 1, what number changes: the numerator or the denominator?",
    "4/3 is past 1. What's the denominator?"
  ],
  "action_description": "Student reads the question, examines the number line with labeled fractions, and selects the correct answer demonstrating understanding that the denominator remains constant.",
  "mastery_tier": [
    "confidence",
    "support",
    "baseline"
  ],
  "mastery_verb": "identify",
  "parameter_coverage": {
    "denominators": [
      3,
      4,
      6
    ],
    "diagnostic_types": [
      "what_stays_same",
      "what_changes",
      "identify_denominator",
      "explain_pattern"
    ]
  },
  "correct_end_state": "Correct answer selected demonstrating understanding that denominator stays constant while numerator increases.",
  "success_dialogue": [
    "Right, the denominator stays the same.",
    "Yes. Only the numerator changes.",
    "Correct. The denominator tells the size of each jump.",
    "Good. Same denominator past 1."
  ]
}
</input>

======================================================================

## Prefill

[{"problem_instance_id":

